# c-for-go configuration for libhivex bindings
# See: https://github.com/xlab/c-for-go/wiki

GENERATOR:
  PackageName: hivex
  PackageDescription: |
    Package hivex provides CGO bindings for libhivex.

    libhivex is a C library for reading and writing Windows Registry "hive" files.
    These files are used by Windows to store the system registry data.

    This package is auto-generated using c-for-go from the libhivex C headers.

    Original libhivex: https://libguestfs.org/hivex.3.html
    License: LGPL v2+

  PackageLicense: |
    // Code generated by c-for-go. DO NOT EDIT.
    //
    // Auto-generated bindings for libhivex.
    // Original libhivex is LGPL v2+.
    // See: https://libguestfs.org/hivex.3.html

  Includes:
    - hivex.h

  FlagGroups:
    - {name: CFLAGS, flags: ["-I/opt/homebrew/include", "-I/usr/local/include", "-I/usr/include"]}
    - {name: LDFLAGS, flags: ["-L/opt/homebrew/lib", "-L/usr/local/lib", "-lhivex"]}

PARSER:
  IncludePaths:
    - /usr/include
    - /usr/local/include
    - /opt/homebrew/include
    - /opt/homebrew/opt/hivex/include

  SourcesPaths:
    - hivex.h

TRANSLATOR:
  ConstRules:
    defines: expand
    enum: expand

  Rules:
    # Global rules for all symbols
    global:
      - {action: accept, from: "^hivex_"}
      - {action: accept, from: "^HIVEX_"}
      - {transform: lower}
      - {load: snakecase}
      - {transform: export}

    # Constant rules
    const:
      - {action: accept, from: "^HIVEX_"}
      - {transform: upper}

    # Type rules
    type:
      - {action: accept, from: "^hive_"}
      - {action: accept, from: "^hivex_"}
      # Skip visitor callback struct (c-for-go generates broken code for callbacks)
      - {action: ignore, from: "^hivex_visitor$"}
      - {transform: export}

    # Function rules
    function:
      - {action: accept, from: "^hivex_"}
      # Skip visitor functions (requires visitor struct which c-for-go can't handle)
      - {action: ignore, from: "^hivex_visit"}
      - {action: ignore, from: "^hivex_visit_node$"}

  # Memory management hints
  MemTips:
    # hive_h* is a raw pointer that we manage
    - {target: "^hive_h$", self: raw}
    # hive_node_h and hive_value_h are integer handles (plain types)
    - {target: "^hive_node_h$", self: plain}
    - {target: "^hive_value_h$", self: plain}
    # hive_type is an enum (plain type)
    - {target: "^hive_type$", self: plain}
    # hive_set_value is a struct
    - {target: "^hive_set_value$", self: plain}

  # Type conversion hints
  TypeTips:
    # Functions that return pointers to arrays
    Function:
      # Functions that return char* (strings)
      - {target: "hivex_node_name", tips: [0, string]}
      - {target: "hivex_value_key", tips: [0, string]}
      - {target: "hivex_value_string", tips: [0, string]}
      - {target: "hivex_value_utf8", tips: [0, string]}

      # Functions that return arrays of handles
      - {target: "hivex_node_children", tips: [0, arr]}
      - {target: "hivex_node_values", tips: [0, arr]}
      - {target: "hivex_value_multiple_strings", tips: [0, arr]}

    # Type definitions
    TypedefGlobal:
      # Integer handle types (not pointers)
      - {target: "^hive_node_h$", tips: [plain]}
      - {target: "^hive_value_h$", tips: [plain]}
      - {target: "^hive_type$", tips: [plain]}

  # Pointer conversion rules
  PtrTips:
    function:
      # Functions that take hive_h* as first argument
      - {target: "^hivex_", self: raw, tips: [0]}
